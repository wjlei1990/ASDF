

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Implementations &mdash; SDF 0.0.1a documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'./',
        VERSION:'0.0.1a',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
    <link rel="top" title="SDF 0.0.1a documentation" href="index.html"/>
        <link rel="next" title="Use Cases" href="use_cases.html"/>
        <link rel="prev" title="Technical Details" href="technical_details.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="icon icon-home"> SDF</a>
        <form class="wy-form" action="search.html" method="get">
  <input type="text" name="q" placeholder="Search docs" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#why-introduce-a-new-seismic-data-format">Why introduce a new seismic data format?</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#the-container">The container</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#the-container-layout">The container layout</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="technical_details.html">Technical Details</a><ul>
<li class="toctree-l2"><a class="reference internal" href="technical_details.html#internal-data-layout">Internal Data Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="technical_details.html#seed-structure-layout">SEED structure layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="technical_details.html#diagram">Diagram</a></li>
<li class="toctree-l2"><a class="reference internal" href="technical_details.html#description-of-processing-elements">Description of Processing Elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="technical_details.html#potential-shortcomings">Potential Shortcomings</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Implementations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#adios-and-fortran">ADIOS and Fortran</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hdf5-and-python">HDF5 and Python</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="use_cases.html">Use Cases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="use_cases.html#earthquake-data">Earthquake data</a></li>
<li class="toctree-l2"><a class="reference internal" href="use_cases.html#ambient-noise-data">Ambient Noise Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="use_cases.html#exploration-data">Exploration Data</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/">SDF</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <ul class="wy-breadcrumbs">
  <li><a href="index.html">Docs</a> &raquo;</li>
  <li><a href="">Implementations</a></li>
  
</ul>
<hr/>

          
  <div class="section" id="implementations">
<h1>Implementations<a class="headerlink" href="#implementations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="adios-and-fortran">
<h2>ADIOS and Fortran<a class="headerlink" href="#adios-and-fortran" title="Permalink to this headline">¶</a></h2>
<div class="section" id="reading-file-content">
<h3>Reading file content<a class="headerlink" href="#reading-file-content" title="Permalink to this headline">¶</a></h3>
<p>The reader is designed to be flexible so that only content the user is
interested can be read into memory. Here are examples of how to read event.asdf</p>
<ul class="simple">
<li>Example 1: Read entire file into memory <tt class="docutils literal"><span class="pre">`read_asdf</span> <span class="pre">event.asdf`</span></tt> You can
also do this in parallel. <tt class="docutils literal"><span class="pre">`parallel_read_asdf</span> <span class="pre">event.asdf`</span></tt></li>
<li>Example 2: Read all waveforms associated with a specific station
<tt class="docutils literal"><span class="pre">`read_waveforms</span> <span class="pre">'Station'</span> <span class="pre">event.asdf`</span></tt></li>
<li>Example 3: Read provenance associated with a specific waveforms
<tt class="docutils literal"><span class="pre">`read_provenance</span> <span class="pre">NET.STA.LOC.CHAN_STARTTIME_ENDTIME[_TAG]</span> <span class="pre">event.asdf`</span></tt></li>
</ul>
</div>
<div class="section" id="writing-file-content">
<h3>Writing file content<a class="headerlink" href="#writing-file-content" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Example 1: Writing all data to event.asdf <tt class="docutils literal"><span class="pre">`write_asdf</span> <span class="pre">event.asdf`</span></tt></li>
<li>In parallel...```parallel_write_asdf event.asdf```</li>
</ul>
</div>
<div class="section" id="converting-other-seismic-data-formats-to-asdf">
<h3>Converting other seismic data formats to ASDF<a class="headerlink" href="#converting-other-seismic-data-formats-to-asdf" title="Permalink to this headline">¶</a></h3>
<p>The format is designed to be exchangeable and in order to facilitate adoption
converters that take existing seismic data formats can go back and forth
between them.</p>
<p>How to convert SAC to ASDF</p>
</div>
</div>
<div class="section" id="hdf5-and-python">
<h2>HDF5 and Python<a class="headerlink" href="#hdf5-and-python" title="Permalink to this headline">¶</a></h2>
<p>This implementation is currently a rough protoytype realized using <a class="reference external" href="http://obspy.org">ObsPy</a> and <a class="reference external" href="http://www.h5py.org">h5py</a>. Usability while
retaining acceptable performance is the key design goal for this
implementation.</p>
<p>It is based around a data set class that has a nice interface to manipulate
data. All operations are transparently mapped to an HDF5 file on disc.</p>
<div class="section" id="creation-of-a-new-file">
<h3>Creation of a new file<a class="headerlink" href="#creation-of-a-new-file" title="Permalink to this headline">¶</a></h3>
<p>This section quickly introduces the creation of a new SDF file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">write_sdf</span> <span class="kn">import</span> <span class="n">SDFDataSet</span>

<span class="c"># If the file does not exist, it will be created,</span>
<span class="c"># otherwise the old one will used.</span>
<span class="n">data_set</span> <span class="o">=</span> <span class="n">SDFDataSet</span><span class="p">(</span><span class="s">&quot;test_file.h5&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>One can add waveform and station data in any order. The class will take care that everything is
mapped to the correct section in the HDF5 file. The use of ObsPy means that we get a converter
for effectively all seismic waveform formats in use to the new format for free.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">glob</span>

<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&quot;*.mseed&quot;</span><span class="p">):</span>
    <span class="n">data_set</span><span class="o">.</span><span class="n">add_waveform_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s">&quot;raw_recording&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&quot;*.xml&quot;</span><span class="p">):</span>
    <span class="n">data_set</span><span class="o">.</span><span class="n">add_stationxml</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>It is also possible to do this with an already existing file. HDF5 is flexible enough.</p>
</div>
<div class="section" id="accessing-data">
<h3>Accessing data<a class="headerlink" href="#accessing-data" title="Permalink to this headline">¶</a></h3>
<p>This interactive session demonstrates how to use the class to access the data.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">data_set</span> <span class="o">=</span> <span class="n">SDFDataSet</span><span class="p">(</span><span class="s">&quot;test_file.h5&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>One can print some information.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">data_set</span>
<span class="go">SDF file: &#39;test_file.h5&#39; (2.7 GB)</span>
<span class="go">    Contains data from 1392 stations.</span>
</pre></div>
</div>
<p>And one can access waveforms and station. Tab completion works just fine. What
comes back are ObsPy objects which should enable a convenient way of working
with the data and outputting it to any other format.</p>
<p>The waveforms can be accessed via the tags. The return type is an ObsPy Stream
object which will be created on the fly when accessing it. This is essence
enables one to work with huge datasets on a laptop as only the part of the data
required at the moment is in memory.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">st</span> <span class="o">=</span> <span class="n">data_set</span><span class="o">.</span><span class="n">waveforms</span><span class="o">.</span><span class="n">AE_113A</span><span class="o">.</span><span class="n">raw_recording</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">st</span>
<span class="go">AE.113A..BHE | 2013-05-24T05:40:00.000000Z - 2013-05-24T06:50:00.000000Z | 40.0 Hz, 168001 samples</span>
<span class="go">AE.113A..BHN | 2013-05-24T05:40:00.000000Z - 2013-05-24T06:50:00.000000Z | 40.0 Hz, 168001 samples</span>
<span class="go">AE.113A..BHZ | 2013-05-24T05:40:00.000000Z - 2013-05-24T06:50:00.000000Z | 40.0 Hz, 168001 samples</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">st</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p>The same is true with the station information which return an ObsPy inventory
object.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">inv</span> <span class="o">=</span> <span class="n">data_set</span><span class="o">.</span><span class="n">waveforms</span><span class="o">.</span><span class="n">AE_113A</span><span class="o">.</span><span class="n">StationXML</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">inv</span>
<span class="go">Inventory created at 2014-02-08T22:06:43.000000Z</span>
<span class="go">        Created by: IRIS WEB SERVICE: fdsnws-station | version: 1.0.10</span>
<span class="go">                    http://service.iris.edu/fdsnws/station/1/query?channel=BH%2A&amp;statio...</span>
<span class="go">        Sending institution: IRIS-DMC (IRIS-DMC)</span>
<span class="go">        Contains:</span>
<span class="go">                Networks (1):</span>
<span class="go">                        AE</span>
<span class="go">                Stations (1):</span>
<span class="go">                        AE.113A (Mohawk Valley, Roll, AZ, USA)</span>
<span class="go">                Channels (3):</span>
<span class="go">                        AE.113A..BHE, AE.113A..BHN, AE.113A..BHZ</span>
</pre></div>
</div>
<p>So now one has all the information needed to process the data. The following
snippet will convert all data for the given station and tag to meters per
second.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">st</span><span class="o">.</span><span class="n">attach_response</span><span class="p">(</span><span class="n">inv</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">st</span><span class="o">.</span><span class="n">remove_response</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s">&quot;VEL&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="large-scale-processing">
<h3>Large Scale Processing<a class="headerlink" href="#large-scale-processing" title="Permalink to this headline">¶</a></h3>
<p>This is not yet fully implemented but will be done soon. So the idea is to
define a function per station and tag. This function will then be applied to
all data and the result will be stored in a new file. If an MPI environment is
detected it will be distributed across all nodes and otherwise <cite>os.fork</cite> will
be used for shared memory multiprocessing. This should all happen behind the
scenes and the user does not have to bother with it.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">station</span><span class="p">):</span>
    <span class="n">stream</span><span class="o">.</span><span class="n">attach_resonse</span><span class="p">(</span><span class="n">station</span><span class="p">)</span>
    <span class="n">stream</span><span class="o">.</span><span class="n">remove_response</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s">&quot;VEL&quot;</span><span class="p">)</span>

<span class="n">data_set</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="s">&quot;new.h5&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="use_cases.html" class="btn btn-neutral float-right" title="Use Cases"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="technical_details.html" class="btn btn-neutral" title="Technical Details"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <p>
      &copy; Copyright 2014, Lion Krischer, James Smith, Jeroen Tromp.
  </p>

  <a href="https://www.github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="http://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

</body>
</html>